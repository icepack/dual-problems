\documentclass{article}

\usepackage{amsmath}
%\usepackage{amsfonts}
\usepackage{amsthm}
%\usepackage{amssymb}
%\usepackage{mathrsfs}
%\usepackage{fullpage}
%\usepackage{mathptmx}
%\usepackage[varg]{txfonts}
\usepackage{color}
\usepackage[charter]{mathdesign}
\usepackage[pdftex]{graphicx}
%\usepackage{float}
%\usepackage{hyperref}
%\usepackage[modulo, displaymath, mathlines]{lineno}
%\usepackage{setspace}
%\usepackage[titletoc,toc,title]{appendix}
\usepackage{natbib}
\usepackage{booktabs}
\usepackage{multirow}

%\linenumbers
%\doublespacing

\theoremstyle{definition}
\newtheorem*{defn}{Definition}
\newtheorem*{exm}{Example}

\theoremstyle{plain}
\newtheorem*{thm}{Theorem}
\newtheorem*{lem}{Lemma}
\newtheorem*{prop}{Proposition}
\newtheorem*{cor}{Corollary}

\newcommand{\argmin}{\text{argmin}}
\newcommand{\ud}{\hspace{2pt}\mathrm{d}}
\newcommand{\bs}{\boldsymbol}
\newcommand{\PP}{\mathsf{P}}

\title{Dual action principles for ice sheet dynamics}
\author{Daniel Shapero, Gonzalo Gonzalez de Diego}
\date{}

\begin{document}

\maketitle

\begin{abstract}
    The momentum conservation equation for glacier flow can be described through minimization of an action functional \citep{bassis2010hamilton, dukowicz2010consistent}.
    Several software packages for glacier flow modeling use this action principle in the design of numerical solution procedures.
    We derive here an equivalent \emph{dual} action principle for the shallow stream approximation and implement this model using the finite element method.
    The key feature of the dual action is that the flow law and friction law are both inverted, which changes the character of the nonlinearities.
    This altered character makes it possible to implement numerical solvers for the dual form that work well with a much wider range of input data than solvers for the primal form can usually cope with.
    In particular, the momentum balance equation remains solvable \emph{even when the ice thickness or strain rate are exactly equal to zero}.
    This robustness makes it possible to implement iceberg calving in a strikingly simple way: the modeler sets the ice thickness to zero in the desired area.
    We provide several demonstrations and a reference implementation.
\end{abstract}


% --------------------
\section{Introduction}

On space and time scales greater than 100m and 1 day, glaciers flow like a viscous, incompressible fluid with a power-law rheology \citep{greve2009dynamics}.
Ice flow is slow enough that the inertial terms in the Navier-Stokes equations can be neglected, i.e. the flow occurs at very low Reynolds number.
There are multiple equivalent ways of expressing the momentum balance equations: a conservation law, a variational form, a partial differential equation.
Each of these forms is best suited to a different type of numerical method.
The momentum balance equation for low-Reynolds number viscous fluid flow can also be derived as the optimality conditions for the velocity to be the critical point of a certain \emph{action functional} \citep{dukowicz2010consistent}.
The action functional has units of energy per unit time and can be interpreted as the rate of dissipation of thermodynamic free energy \citep{edelen1972nonlinear}.
For many problems -- low-Reynolds number flow, heat conduction, saturated groundwater flow, steady elasticity -- the action is a convex functional of the unknown field.

The existence of an action principle is a special property of a very restricted class of differential equations.
Action principles are not just of theoretical interest -- we can use them to design faster, more robust numerical solvers.
First, a convex action principle implies that the second derivative is symmetric and positive-definite.
These properties guarantee convergence for Newton-type algorithms.
They also mean that we can use specialized methods, such as Cholesky factorization or the conjugate gradient method, for solving the resulting linear systems of equations \citep{nocedal2006numerical}.
These methods are not applicable to more general classes of linear systems.
Second, the action principle offers a way to measure how well an approximate solution matches the true solution and it is distinct from, say, the square norm of the residual.
The theory of convex optimization then provides us with a way to measure how close we are to convergence without having to know what the true solution is.
In \citet{shapero2021icepack}, we showed how to use this theory to design physics-based convergence criteria.

This work follows in the footsteps of \citet{dukowicz2010consistent} in studying action principles for glacier flow.
Our main contribution is the derivation of an alternative \emph{dual} action principle, distinct from that presented in \citet{dukowicz2010consistent}, from which the momentum conservation equations can be derived.
The most important feature is that \textbf{the dual action principle has favorable numerical properties for shear-thinning flows} such as glacier dynamics.
Solving the primal form of the problem requires regularization around zero strain rate, velocity, and thickness in order to smooth away infinite values.
This regularization makes the momentum balance problem solvable, but it remains poorly conditioned and introduces other non-physical artifacts.
\textbf{The dual problem requires no regularization.}
We have implemented solvers for this dual form that still converge even when the thickness and strain rate are zero.
As a consequence, \textbf{we were able to simulate iceberg calving by setting the ice thickness to zero} in part of the glacier.
We illustrate these advantages in the final section with a numerical implementation and several demonstrations.

In the following, we will assume familiarity with (1) the partial differential equations describing glacier flow, (2) variational calculus and the derivation of the Euler-Lagrange equations of a generic functional, and (3) convex analysis and convex duality theory.
For background reading, we refer the reader to \citet{greve2009dynamics} for glacier dynamics, \citet{weinstock1974calculus} for variational calculus, and \citet{boyd2004convex} for convex optimization.



% --------------
\section{Theory}

\subsection{The shallow stream equations}

Here we review the differential equations that are commonly used to describe glacier flow.
In section \S\ref{sec:primal-action-principles}, we will show how the momentum balance equation has a minimization principle.

The most common starting point for modeling glacier momentum balance is the Stokes equations with a power-law rheology, commonly known as Glen's law \citep{glen1958law, greve2009dynamics}.
Numerically solving the Stokes equations in 3D has a high computational cost.
For this reason, it is common to simplify these equations using the fact that most glaciers have a small ratio of thickness to horizontal extent.
One can then eliminate the pressure and vertical velocity from the Stokes equations by taking only the 0th-order term in an asymptotic expansion of the Stokes equations in the aspect ratio.
The resulting equation set is usually called the \emph{first-order} or \emph{Blatter-Pattyn} equation \citep{greve2009dynamics}.

In certain flow regimes, some components of the strain rate tensor become neglible and this enables further simplifications of the first-order equations.
Here we focus on the \emph{shallow stream/shelf approximation} (SSA), which is commonly applied to model fast-flowing outlet glaciers and ice streams \citep{greve2009dynamics}.
The SSA assumes that the vertical variation of the horizontal velocity is negligible, i.e. the velocity field is approximately a plug flow.
In other words, the $x-z$ components of the strain rate tensor are much smaller than the $x-x$, $x-y$, and $y-y$ components.
With this approximation, we can depth-average the first-order equations and the result is the SSA.
The equations of motion are solved in a two-dimensional domain $\Omega$ whose boundary we denote by $\partial\Omega$.

The main unknown to be solved for in the SSA is the depth-averaged ice velocity $u$.
Some important intermediate quantities are the basal shear stress $\tau$ and the \emph{membrane stress} tensor $M$, a rank-2 tensor with units of stress that results from applying the low-aspect ratio assumption to the full 3D deviatoric stress tensor.
The inputs to the problem include the thickness $h$, surface elevation $s$, and fluidity factor $A$ in Glen's flow law.
The SSA momentum conservation equation is
\begin{equation}
    \nabla\cdot hM + \tau - \rho_I gh\nabla s = 0,
    \label{eq:membrane-stress-conservation}
\end{equation}
where $\rho_I$ is the ice density, and $g$ the gravitational acceleration.
In addition to \eqref{eq:membrane-stress-conservation}, we need to know a constitutive relation between the membrane stress tensor and the depth-averaged strain rate tensor
\begin{equation}
    \dot\varepsilon = \frac{1}{2}\left(\nabla u + \nabla u^\top\right).
    \label{eq:strain-rate}
\end{equation}
In order to simplify the notation later, we introduce the dimensionless rank-4 tensor $\mathscr{C}$ defined by
\begin{equation}
    \mathscr{C}\dot\varepsilon = \frac{\dot\varepsilon + \text{tr}(\dot\varepsilon)I}{2}.
    \label{eq:elasticity-tensor}
\end{equation}
The tensor $\mathscr{C}$ plays a similar role to the elasticity tensor in linear elasticity.
Moreover, we define the norm of a rank-2 tensor with respect to $\mathscr{C}$ as
\begin{equation}
    |\dot\varepsilon|_{\mathscr{C}}^2 = \dot\varepsilon : \mathscr{C}\dot\varepsilon.
\end{equation}
With these notational conveniences in hand, the Glen flow law states that the membrane stress and strain rate are related by a power law:
\begin{equation}
    M = 2A^{-\frac{1}{n}}|\dot\varepsilon|_{\mathscr C}^{\frac{1}{n} - 1}\mathscr{C}\dot\varepsilon
    \label{eq:constitutive-relation}
\end{equation}
where $A$ is the fluidity coefficient and $n \approx 3$ is the Glen flow law exponent.

Next, we need to provide some kind of sliding relation.
We will assume a generalized power law with some exponent $m$, i.e.
\begin{equation}
    \tau = -C|u|^{\frac{1}{m} - 1}u.
    \label{eq:sliding-law}
\end{equation}
Weertman sliding has $m = n$, while perfectly plasting sliding has $m = \infty$.
Recent research suggests alternative forms that transition between Weertman-type sliding at low speeds and perfectly plasting sliding at higher speeds \citep{minchew2020toward}.
For illustrative purposes equation \eqref{eq:sliding-law} is sufficient, and we will describe how to incorporate alternatives in the discussion.

Finally, the thickness evolves in time according to the following depth-averaged mass conservation equation:
\begin{equation}
    \frac{\partial h}{\partial t} + \nabla \cdot hu = \dot a - \dot m,
    \label{eq:conservation-mass}
\end{equation}
where $\dot a$ is the rate of ice accumulation and $\dot m$ of melting or ablation.

For modelling a floating ice shelf, the friction term in \eqref{eq:membrane-stress-conservation} is zero.
Moreover, assuming the ice is in hydrostatic equilibrium allows us to write the surface elevation in terms of the thickness:
\begin{equation}
    s = (1 - \rho_I / \rho_W) h.
    \label{eq:flotation-condition}
\end{equation}
As a result, the momentum conservation equation reduces to
\begin{equation}
    \nabla\cdot hM - \frac{1}{2}\varrho g\nabla h^2 = 0.
\end{equation}
where $\varrho = (1 - \rho_I / \rho_W)\rho_I$ is the reduced density of ice over seawater.

Marine ice sheets flow from the continent and into the ocean, where they go afloat.
If we are to model a marine ice sheet with the SSA, we must distinguish between a grounded and a floating region.
This results in a free boundary problem where ice goes afloat once the condition \eqref{eq:flotation-condition} is satisfied.
The boundary separating grounded from floating ice is known as the grounding line $x_g$.
The possibility of a marine ice sheet isntability that could dramatically increase the rate of discharge of ice into the ocean has led to a substantial amount of research into grounding line dynamics \citep{schoof2007mis, durand2009mis, favier2012mis}.

Finally, we need to supply a set of boundary conditions for the problem to be well-posed.
Along the part of the boundary where ice is flowing into the domain, we assume that the ice velocity is known from observations; this is a Dirichlet boundary condition.
At the glacier terminus, which we will denote by $\Gamma$, the membrane stresses at the cliff face are balanced by pressures from any proglacial water body.
This is a Neumann boundary condition:
\begin{equation}
    -hM\cdot\nu = \frac{1}{2}\left(\rho_Igh^2 - \rho_Wgh_W^2\right)\nu,
    \label{eq:terminus-bc}
\end{equation}
where $h_W$ is the water depth and $\nu$ is the unit outward-pointing normal vector to the terminus.

We can then combine equations \eqref{eq:membrane-stress-conservation}-\eqref{eq:sliding-law} to arrive at a second-order, nonlinear system of differential equations for $u$.


% --------------------------------
\subsection{Primal action principles}
\label{sec:primal-action-principles}

The main idea behind \emph{action} or \emph{minimization} principles is that some partial differential equations really express the fact that their solutions are extrema of a given \emph{action functional}.
The momentum balance equation of glacier flow is one such PDE.
Many publications in the glacier flow modeling literature have explored the advantages of using action principles to describe the momentum balance \citep{bassis2010hamilton, dukowicz2010consistent, brinkerhoff2013data, shapero2021icepack}.
Here we briefly review these concepts as they pertain to the SSA momentum balance.

Given a particular action functional, the PDE that expresses the condition that a field is an extremum can be calculated mechanically in terms of the integrand.
This PDE is called the \emph{Euler-Lagrange} equation for the functional.
We will not repeat it here but see \citet{weinstock1974calculus}.
On the other hand, given an arbitrary PDE, there is no rote procedure that will determine if it is an Euler-Lagrange equation and what the corresonding functional should be.
The dichotomy is akin to the fact that differentiation can always be carried out symbolically while computing anti-derivatives cannot.
The main mathematical hurdle to overcome in determining what the action functional is for a particular problem is computing the anti-derivatives of certain terms in the differential equation.

The constitutive relation \eqref{eq:constitutive-relation} for $M$ can be expressed as the derivative of a certain scalar quantity:
\begin{equation}
    M = \frac{d}{d\dot\varepsilon}\left(\frac{2n}{n + 1}A^{-\frac{1}{n}}|\dot\varepsilon|_{\mathscr C}^{\frac{1}{n} + 1}\right)
    \label{eq:M-anti-derivative}
\end{equation}
if we think of the strain rate tensor as an independent variable and briefly forget that it is the symmetrized velocity gradient.
Likewise, for the sliding relation \eqref{eq:sliding-law}, we can observe that
\begin{equation}
    \tau = -\frac{d}{du}\left(\frac{m}{m + 1}C|u|^{\frac{1}{m} + 1}\right).
    \label{eq:tau-anti-derivative}
\end{equation}
Using equations \eqref{eq:M-anti-derivative} and \eqref{eq:tau-anti-derivative}, we can show that the SSA momentum balance are the Euler-Lagrange equations for the following action functional:
\begin{align}
    J(u) & = \int_\Omega\left(\frac{2n}{n + 1}hA^{-\frac{1}{n}}|\dot\varepsilon|_{\mathscr{C}}^{\frac{1}{n} + 1} + \frac{m}{m + 1}C|u|^{\frac{1}{m} + 1} + \rho_I gh\nabla s\cdot u\right)dx  \nonumber \\
    & \qquad + \frac{1}{2}\int_{\Gamma_t}\left(\rho_Igh^2 - \rho_Wgh_W^2\right)u\cdot\nu\; d\gamma
    \label{eq:ssa-primal-action}
\end{align}
Note that the action has units of energy per unit time, or power.
A mechanical computation of the second derivative of $J$ shows that this functional is convex.
The theory of non-equilibrium thermodynamics tells us that $J$ represents the rate of dissipation of thermodynamic free energy \citep{edelen1972nonlinear}.
Once again, the essential point is that finding a minimizer $u$ of the functional $J$ defined above is equivalent to finding a solution of the SSA differential equation.


% ------------------------------
\subsection{Dual action principles}
\label{subsec:dual-action-principles}

Action principles have appeared in glaciology before, but dual forms have not.
The dual form of a problem is a distinct but equivalent expression of the same underlying physics.
We will show in the following that, for the particular case of the SSA momentum balance, the dual form has some better numerical properties that make it worth investigating.

The dual form can be understood at two levels.
First, we can show what the dual action functional is without describing how we came up with it.
A reader who knows some variational calculus can derive the Euler-Lagrange equations for this functional and verify that the resulting equation set is equivalent to the primal form of the SSA.
We present an exposition at this level below.
On the other hand, this approach can feel like pulling a rabbit out of a hat; it does not answer how we arrived at the dual form in the first place or how we might derive the dual forms of other problems.
This level requires some knowledge of general convex duality theory.
We assume that few glaciologists will be interested in this level of detail and refer instead to sections 9.7 and 9.8 of \citet{attouch2014variational}.

Equations \eqref{eq:membrane-stress-conservation}-\eqref{eq:sliding-law} and \eqref{eq:terminus-bc} can be combined into a second-order differential equation for the velocity $u$.
Solving this differential equation is equivalent to finding a minimizer of the functional $J$ defined in equation \eqref{eq:ssa-primal-action}.
In deriving the differential equation, we used the constitutive relation and the sliding law (equations \eqref{eq:constitutive-relation} and \eqref{eq:sliding-law}) to eliminate the membrane stress $M$ and basal stress $\tau$.
We could instead \textbf{keep these additional equations and unknowns.}
Instead of solving a second-order equation for $u$, we would then have an equivalent first-order system of equations for $u$, $M$, and $\tau$.
One way to motivate the dual problem is to ask: \textbf{is there an optimization problem that is equivalent to this first-order system?}
As we will show below, there is, but it has some different characteristics from the primal problem.
One of the key features of dual forms in general is that they invert constitutive relations.
Conventionally, we write the membrane stress tensor as a function of the strain rate tensor, and the basal shear stress as a function of the sliding velocity.
The dual form inverts these relations: the strain rate tensor becomes a function of the membrane stress tensor, and the sliding velocity a function of the basal shear stress.

In equation \eqref{eq:elasticity-tensor}, we defined the rank-4 tensor $\mathscr{C}$ as a convenience for writing down how the membrane stress is a function of the strain rate.
We can show explicitly that the inverse $\mathscr{A}$ of this tensor $\mathscr{C}$ is:
\begin{equation}
    \mathscr{A}M = \frac{M - \frac{1}{d + 1}\text{tr}(M)I}{2}
\end{equation}
where $d = 2$ is the space dimension.
The tensor $\mathscr{A}$ plays an analogous role to the compliance tensor in linear elasticity.
With this definition in hand, we can invert equation \eqref{eq:constitutive-relation} to get $\dot\varepsilon = 2A|M|_{\mathscr{A}}^{n - 1}\mathscr{A}M$.
The sliding law is much easier to invert: $u = -C^{-m}|\tau|^{m - 1}\tau$.
We can then define a slipperiness coefficient $K = C^{-m}$.

With these preparations in place, the dual form is:
\begin{align}
    L(u, M, \tau) = & \int_\Omega\Bigg\{\frac{2}{n + 1}hA|M|_{\mathscr A}^{n + 1} + \frac{1}{m + 1}K|\tau|^{m + 1} \nonumber\\
    & \qquad\qquad - hM:\dot\varepsilon(u) + \tau\cdot u - \rho_Igh\nabla s\cdot u\Bigg\}dx \nonumber \\
    & \qquad - \frac{1}{2}\int_\Gamma\left(\rho_Igh^2 - \rho_Wgh_W^2\right)u\cdot\nu\;d\gamma
    \label{eq:ssa-dual-form}
\end{align}
We can then evaluate the variational derivatives of $L$ with respect to $u$, $M$, and $\tau$, require that these derivatives are all zero, and show that the resulting equations are equivalent to the primal form of the problem.
First, if we require that the variational derivative of $L$ with respect to $M$ along any perturbation $N$ is zero, we find that
\begin{equation}
    \left\langle\frac{\partial L}{\partial M}, N\right\rangle = \int_\Omega\left\{2hA|M|_{\mathscr{A}}^{n - 1}\mathscr{A}M - h\dot\varepsilon(u)\right\} : N\; dx = 0.
\end{equation}
This equation is the variational form of the inverse of the constitutive relation (equation \eqref{eq:constitutive-relation}).
Next, taking the variational derivative of $L$ with respect $\tau$ along some perturbation $\sigma$, we get
\begin{equation}
    \left\langle\frac{\partial L}{\partial\tau}, \sigma\right\rangle = \int_\Omega\left\{K|\tau|^{m - 1}\tau + u\right\}\cdot\sigma\;dx = 0
\end{equation}
which is the inverse of the sliding law of equation \eqref{eq:sliding-law}.
Finally, let $v$ be any perturbation to the velocity field such that $v = 0$ along the inflow boundary.
Taking the variational derivative of $L$ with respect to $u$ along $v$ gives
\begin{align}
    \left\langle\frac{\partial L}{\partial u}, v\right\rangle & = \int_\Omega\left\{-hM : \dot\varepsilon(v) + \tau\cdot v - \rho_Igh\nabla s\cdot v\right\}dx \nonumber\\
    & \qquad -\frac{1}{2}\int_{\Gamma}\left(\rho_Igh^2 - \rho_Wgh_W^2\right)v\cdot\nu\;d\gamma
\end{align}
which is not exactly what we want.
We can use integration by parts to push the symmetric gradient of $v$ over onto $h\,M$ in the first term however:
\begin{align}
    \ldots & = \int_\Omega\left\{\nabla\cdot hM + \tau - \rho_Igh\nabla s\right\}\cdot v\;dx \\
    & \qquad + \int_\Gamma\left(hM\cdot\nu - \frac{1}{2}\left(\rho_Igh^2 - \rho_Wgh_W^2\right)\nu\right)\cdot v\;dx.
\end{align}
If we require that this is equal to 0 for all perturbation fields $v$, we recover both conservation of membrane stress (equation \eqref{eq:membrane-stress-conservation}) and the boundary condition (equation \eqref{eq:terminus-bc}).
In effect, finding a critical point of the dual action functional is a constrained optimization problem; the velocity field acts like a Lagrange multiplier that enforces the constraint of stress conservation.

\begin{figure}[h]
    \includegraphics[width=0.48\linewidth]{demos/singularity/primal.pdf}\includegraphics[width=0.48\linewidth]{demos/singularity/dual.pdf}
    \caption{The viscous part of the action for the primal problem as a function of the strain rate (left) and for the dual problem as a function of the stress (right).
    The second derivative of the viscous dissipation goes to infinity near zero strain rate for the primal problem, but to zero near zero stress for the dual problem.}
    \label{fig:primal-vs-dual}
\end{figure}

The important feature of the dual formulation is that \textbf{the nature of the nonlinearity has changed}.
In the primal action shown in equation \eqref{eq:ssa-primal-action}, the nonlinearity consists of the strain rate raised to the power $\frac{1}{n} + 1$.
Since $n > 1$, the nonlinearity in the primal form has an infinite singularity in its second derivative around any velocity field with zero strain rate.
In the dual form, however, the nonlinearity consists of the stress tensor raised to the power $n + 1$.
Around zero stress, the second derivative of the action with respect to the stress is zero instead of infinity; see figure \ref{fig:primal-vs-dual}.



% ----------------------
\section{Demonstrations}

We implemented a solver for the dual form of the SSA using the Firedrake package \citep{FiredrakeUserManual}.
For more information on discretizing the dual form using finite elements, see Appendix \ref{app:discretization}, and for strategies to solve the resulting finite-dimensional optimization problem, see Appendix \ref{app:solution}.
Here we will present the verification exercises that we used to evaluate the correctness of our implementation, as well as demonstrations of the new capabilities of the dual form compared to the primal form.

Verification is the process of demonstrating that we have correctly specified the dual form of the shallow stream equations and that we can solve them accurately.
A typical verification experiment would be to first find an analytical solution of the physics problem of interest and then calculate the misfit between the exact and numerical solutions as the mesh is refined.
Finite element theory predicts that, as the mesh spacing $\delta x$ is decreased, the misfits decrease asymptotically as $\delta x^p$ for some exponent $p$ depending on the norm, the polynomial order of the basis, and the problem.
We cannot actually evaluate the limit as $\delta x \to 0$.
The best we can do is use a sequence of refined meshes and compute a log-log fit of the errors against the mesh spacing.
If the slope in log-log space of the misfit-mesh spacing curve is close to the expected power $p$, then we have gained some confidence that we have implemented the physics model correctly.
Note that we cannot prove definitively that the implementation is correct; we can only try to find the most rigorous tests we can that might reveal the presence of an error.
% Except for that student of Andrew Appell who did exactly that...

Comparing numerical results against analytically solvable test cases is vital for catching bugs in the code.
Numerical methods do not always fail discretely, so these bugs can be more subtle than, say, the solver crashing.
For example, a common mistake might be to evaluate the viscosity of ice as some constant times \texttt{epsilon ** (-2 / 3)} where \texttt{epsilon} is the absolute value of the strain rate.
In Fortran and C, integer division gives integer results, so this expression would evaluate to \texttt{epsilon ** 0} which is equal to 1.
(By contrast, in Python, integer division can give a floating point result.)
The simulation would describe a linear viscous fluid flow, whereas glacier flow is a nonlinear shear-thinning fluid flow.
The results would still look like a viscous fluid flow and thus might seem fine in the eyeball norm.
Comparing them to an analytical solution, however, would at least reveal the presence of a problem.

The verification experiments that we present below are all taken from those used to test the implementation of the primal form of the SSA in the icepack package \citep{shapero2021icepack}.
The linear ice shelf and ice stream experiments are analytically solvable.
The gibbous ice shelf test case is not analytically solvable.
Instead, we take it on faith that the solvers in icepack are implemented correctly, and check that the dual form solver we present here reproduces the same results as icepack to within discretization error.


\subsection{Linear ice shelf and ice stream} \label{sec:linear-ice-shelf}

\begin{figure}[h]
    \begin{center}
        \includegraphics[width=0.75\linewidth]{demos/convergence-tests/results.pdf}
    \end{center}
    \caption{Relative $L^2$-norm errors for approximate solutions to the analytical ice shelf (left) and ice stream (right) test cases.
    Convergence rate obtained through a log-log fit of errors against mesh size.}
    \label{fig:linear-glacier-convergence-rate}
\end{figure}

As a first check that we implemented the dual form of the SSA correctly, we used the exact solution for a floating ice shelf with thickness
\begin{equation}
    h = h_0 - \delta h \cdot x / L_x
\end{equation}
in a domain of length $L_x = 20$km.
With a constant value of the fluidity coefficient, the velocity in the $x$ direction is
\begin{equation}
    u_x = u_0 + L_x A \left(\frac{\rho_I g h_0}{4}\right)^n\left(1 - \left(1 - \frac{\delta h \cdot x}{h_0\cdot L_x}\right)^{n + 1}\right).
\end{equation}
We used a 2D domain in order to make sure that the numerical solution, like the exact solution, has no variation in the $y$ direction.
We tested meshes with between 16 and 256 cells to a side and we used both degree-1 and degree-2 finite elements for the velocity.
The relative errors in the $L^2$ norm have the expected asymptotic convergence rates of $\mathscr{O}(\delta x^2)$ for linear velocity elements and $\mathscr{O}(\delta x^3)$ for quadratic; see figure \ref{fig:linear-glacier-convergence-rate}.

Next, we performed an experiment on the same geometry and meshes but with basal friction and the ice thickness above flotation.
Solving the resulting boundary value problem analytically in the presence of friction is now much more difficult.
Instead, we used the method of manufactured solutions -- we picked the ice velocity, thickness, and surface elevation, and generated a friction coefficient that would make this velocity an exact solution.
To generate this friction coefficient we used the computer algebra system sympy \citep{sympy}.
The numerical solutions again converge with the expected accuracy of $\mathscr{O}(\delta x^2)$ for linear velocity elements and $\mathscr{O}(\delta x^3)$ for quadratic elements.
See figure \ref{fig:linear-glacier-convergence-rate}.

While finite element theory can predict the asymptotic convergence rates, it does not immediately give estimates of what the constant prefactor should be except in the most trivial of linear problems.
The constants can only be evaluated empirically.
In particular, the theory predicts that quadratic elements converge faster asymptotically than linear elements, but it cannot tell us how many cells per side are necessary for each to achieve the same accuracy.
Figure \ref{fig:linear-glacier-convergence-rate} shows that a numerical solution obtained with only 16 cells per side and quadratic elements is roughly as accurate as a solution with 256 cells per side and linear elements.

\subsection{Slab of ice flowing into the ocean}

\begin{figure}[h]
\centering
    \includegraphics[width = 0.8\linewidth]{demos/slab/figures/marine_ice_sheet.pdf}
    \caption{Setup for modelling a slab of ice on an inclined bed flowing into the ocean. At $x = 0$ we enforce a thickness $h = 500\,\mathrm{m}$ in order to approach a parallel slab of ice far upstream of the grounding line. The dotted line represents the sea level.}
    \label{fig:domain_parallel_slab}
\end{figure}

As a more challenging test in a flowline setting, we consider a slab of ice of constant thickness flowing down an inclined slope into the ocean, where it goes afloat at the grounding line, as illustrated in Figure \ref{fig:domain_parallel_slab}. We compute steady states under this configuration using the primal and dual methods described above. We set the ice thickness at $x = 0$ to $h = 500\, \mathrm{m}$ and the bedrock angle to $\alpha = 1^\circ$. The bed is given by the expression
%
\begin{align}
    b(x) = 1500 - x\tan{\alpha},
\end{align}
%
with units in meters. For the material parameters, we set $n = 3$, $A = 10^{-24}\,\mathrm{Pa}^{-3}\,\mathrm{s}^{-1}$, $C = 10^{-6}\,\mathrm{Pa}\,\mathrm{m}^{-1/3}\mathrm{s}^{1/3}$. Instead of setting inflow boundary conditions at $x = 0$, we enforce a zero extensional stress condition $M = 0$.  This condition allows the ice sheet to tend to the uniform thickness slab solution far upstream of the grounding line. For the uniform slab, the extensional stresses are equal to zero and the frictional stresses at the base of the ice sheet balance the gravitational forces. As a result, the horizontal velocity for the uniform thickness slab is given by
%
\begin{align}\label{eq:u_slab}
    u = \left(\frac{\rho_I g h \tan(\alpha)}{C}\right)^n.
\end{align}
%
A consequence of enforcing the slab solution at the left boundary is that, as we move upstream away from the grounding line, the strain rate tends to zero and one must regularise the primal formulation of the momentum balance equation.

For this problem, we not only solve for the velocity $u$ or the velocity-stress pair $(u,M)$, but also for the thickness $h$ and the grounding line position $x_g$. We therefore complement the momentum balance equations with the mass balance equation \eqref{eq:conservation-mass} and the flotation condition \eqref{eq:flotation-condition}, effectively yielding a free boundary problem.

We solve the free boundary problem with a primal method that seeks the velocity and thickness in $CG(2)\times CG(2)$, and with a dual method that computes the velocity, membrane stress and thickness in the space $CG(2)\times DG(1)\times CG(2)$. For the primal method, we consider a sequence of regularisation parameters $\epsilon$ between $1\, \mathrm{yr}^{-1}$ and $10^{-12}\,\mathrm{yr}^{-1}$. The results for the grounding line position are displayed in Table \ref{tab:slab}. The discrete problem is solved with Newton's method, and the initial guess for the values of the ice velocity, the ice thickness, and the extensional stress are set equal to the slab solution, such that $h = 500\,\mathrm{m}$, $u$ is equal to \eqref{eq:u_slab}, and $M = 0$. The initial guess for the grounding line position is set to the point where the flotation condition \eqref{eq:flotation-condition} holds for the constant thickness slab. We plot the values of the relative Newton residual in Figure \ref{fig:newton-its}. We can see that not only is the dual method just as accurate as the primal method solved using the lowest value of regularisation, but the rate of convergence of the Newton solver for the primal formulation quickly decreases for low values of $\epsilon$. In fact, for values of $\epsilon$ equal to or lower than $10^{-14}\,\mathrm{yr}^{-1}$, the relative Newton residual no longer reaches the minimum tolerance of $10^{-8}$ that we set for this problem.

%\renewcommand{\arraystretch}{1.25}
\begin{table}[h]
\centering
\caption{Results for the slab of ice flowing into the ocean. Values of the steady state grounding line position $x_g$ and thickness at the grounding line for computations with the primal formulation with varying regularisation parameters $\epsilon$ and with the dual formulation. We also present the number of Newton iterations required to converge.}
\label{tab:slab}
\begin{tabular}{ccccc}
\toprule
solver & $\epsilon\,\mathrm{yr}^{-1}$ & $x_g\,\mathrm{km}$ & $h(x_g)\,\mathrm{m}$ & iterations \\
\midrule
\input{demos/slab/tables/table_alpha1.00.txt}
\end{tabular}
\end{table}

\begin{figure}[h]
    \centering
    \includegraphics[width=\linewidth]{demos/slab/figures/newton_its_alpha1.00.pdf}
    \caption{Results for the slab of ice flowing into the ocean. Norm of the relative Newton residual for computations with the primal formulation with varying regularisation parameters $\epsilon$ and with the dual formulation.}
    \label{fig:newton-its}
\end{figure}

\subsection{Gibbous ice shelf} \label{sec:gibbous-ice-shelf}

\begin{figure}[h]
    \begin{center}
        \includegraphics[width=0.85\linewidth]{demos/gibbous-ice-shelf/steady-state.pdf}
    \end{center}
    \caption{The thickness, velocity, and magnitude of the membrane stress tensor in steady state.}
    \label{fig:gibbous}
\end{figure}

\begin{figure}[h]
    \begin{center}
        \includegraphics[width=0.85\linewidth]{demos/gibbous-ice-shelf/volumes.pdf}
    \end{center}
    \caption{Total volume of ice in the shelf over time.
    The different spin-up and experimental phases are labelled.
    Note how the finer spin-up equilibrates to a smaller ice volume than the coarser spin-up.}
    \label{fig:gibbous-calving-volumes}
\end{figure}

\begin{figure}[h]
    \begin{center}
        \includegraphics[width=0.85\linewidth]{demos/gibbous-ice-shelf/calved-thickness.pdf}
    \end{center}
    \caption{The thickness of the ice shelf immediately after the calving event.
    We remove a semi-circular segment from the end of the shelf with a prescribed center and radius.
    The nonlinear solver for the velocity and membrane stress still converges with this thickness input.}
    \label{fig:gibbous-calving-thickness}
\end{figure}

As a second check that the dual form of the momentum balance equation produces the same answers as the primal form, we used the synthetic ``gibbous'' ice shelf test case from \S5.3 of \citet{shapero2021icepack}.
The domain consists of the intersection of two circles of different radii chosen to roughly mimic the overall size of Larsen C.
We prescribe the inflow thickness and velocity and run the coupled mass and momentum balance equations for 400 years on a mesh with a 5km resolution, at which point the system is close to steady state.
We then project these fields to a finer mesh with a resolution of 2km and use them as the initial state for a further 400 years of spin-up.
The results are shown in figure \ref{fig:gibbous} and are identical to those obtained from the primal form of the problem up to discretization error.

As a third and final phase of this experiment, we run the same simulation, but every 24 years we set the ice thickness to 0 in a prescribed region near the terminus.
This forcing mimics the effect of a large iceberg calving event.
Our prescribed evolution of the terminus is not a realistic representation of how calving works.
Instead, we aim only to stress test the solver in order to see if it can handle regions of zero thickness.
We have never succeeded at implementing a solver for the primal form of the problem that works well when the ice thickness is zero.
By contrast, our solver for the dual problem still performs gracefully in ice-free areas.
This feature offers the possibility of implementing physically-based calving models in a simple way.

Figure \ref{fig:gibbous-calving-volumes} shows the evolution of the volume of ice in the shelf over the two spin-up phases and the calving phase.
The 24-year recurrence interval is not enough time for the ice to advance back to the original edge of the computational domain.
Using a longer interval would allow the calving terminus to advance back to its original position.
Figure \ref{fig:gibbous-calving-thickness} shows the thickness of the ice shelf immediately after the calving event.

The number of nonlinear solver iterations to recompute the ice velocity after the calving event is much greater than after a normal timestep.
This behavior is to be expected if we run the solver to convergence because it introduces a type of shock into the system.
As the system relaxes back, the number of iterations decreases again.
Moreover, we had to do some manual adjustment of the convergence tolerances.
Several different strategies can alleviate the need for manual adjustment; see Appendix \ref{app:solution}.


\subsection{Larsen C Ice Shelf}

\begin{figure}[h]
    \begin{center}
        \includegraphics[width=0.75\linewidth]{demos/larsen/contours.pdf}
    \end{center}
    \caption{Calving terminus locations for Larsen C Ice Shelf prognostic simulation.
    The contours shown are at the start of the run, immediately after the simulated calving event, and several years later when the ice shelf has readvanced slightly.}
    \label{fig:larsen-terminus-position}
\end{figure}

To test the dual momentum balance equations on a realistic problem, we simulated the evolution of the Larsen C Ice Shelf through the calving of Iceberg A-68 in 2017 \citep{larour2021physical}.
We used the observed front positions from satellite imagery to set the terminus positions before and after the calving event; we did not implement a calving law as such.
The Larsen C simulation requires several steps.
\begin{enumerate}
    \item We first estimated the fluidity field (the coefficient $A$ in the Glen law $\dot\varepsilon = A\tau^3$) of the ice shelf from remote sensing measurements of the thickness and velocity.
        This step uses the primal form of the momentum balance equation from icepack.
    \item We extrapolated the ice thickness and velocity onto a larger spatial domain.
    \item We ran the simulation using the mass and dual momentum balance from the nominal start date of 2015 until the time of the calving event in \textcolor{red}{2017}.
    \item We digitized the terminus position immediately after the calving event by hand and use the digitized terminus position to define an ice mask.
        \textcolor{red}{We only have a digitized outline for 2019 so we actually used that as the calving event time, we should probably fix that before submitting this, but the idea is the same.}
    \item Using this mask, we set the ice thickness to zero over the spatial extent of the calved area.
    \item We ran the simulation for several more years after the calving event to see how the terminus advances again.
\end{enumerate}
The simulated terminus positions are shown in figure \ref{fig:larsen-terminus-position}.
The model can effectively handle the shock of a calving event and the subsequent readvance of the terminus.

We used the CG(1)/DG(0) pair for the velocity and stress as in the previous examples.
To simulate the evolution of the glacier thickness, we used DG(1) elements together with the upwind numerical flux.
We found that using a DG discretization was necessary to get a reasonable-looking thickness.
When using continuous elements for the thickness, we found that the thickness field would develop spurious oscillations generated at the calving terminus.
This finding is to be expected because continuous elements usually fare poorly at advecting sharp features like an advancing ice cliff.

To solve the dual momentum balance equation, we used a linearly implicit scheme (see Appendix \ref{subsec:linearly-implicit-schemes}) with a hand-tuned choice of 10 Newton steps per iteration.
This approach does not exactly solve the discretized dual momentum balance equation with finite timesteps but the approximation error converges to zero in the limit as the stepsize is reduced.


\subsection{Kangerdlugssuaq Glacier}

As our final test case, we studied Kangerdlugssuaq Glacier, a grounded outlet glacier on the east coast of Greenland.
Kangerdlugssuaq is one of the top three contributors to the total discharge from Greenland \citep{enderlin2014improved, mouginot2019forty}.
The purpose of this exercise is to demonstrate that we can simulate the evolution of a marine-terminating glacier, including the seasonal advance and retreat of the terminus in response to ocean-induced frontal ablation in summer, using the dual form of the momentum balance equation.
We do not aim to reproduce the exact calving history.

The simulation of Kangerdlugssuaq proceeds in several steps, similar to our approach for Larsen C:
\begin{enumerate}
    \item We first estimate the friction field (the coefficient $K$ in the sliding law $u|_{z = b} = -K|\tau_b|^{n - 1}\tau$) from remote sensing measurements of the ice thickness, surface elevation, and velocity.
        This step uses the primal form of the momentum balance equation from icepack.
    \item We extrapolated the thickness, surface elevation, velocity, and friction coefficient onto a large spatial domain that extends further down Kangerdlugssuaq Fjord.
    \item We ran the simulation using the mass and dual momentum balance equations for one year in order to propagate out any initial transients.
        This stage uses only surface mass balance and thus permits the glacier to advance down the fjord.
    \item We then turned on a time-periodic ablation field near the terminus in order to represent the effects of summer melt and calving and ran the simulation for a further four years.
        This ablation field forces the terminus to advance and retreat.
\end{enumerate}
For the initialization, we used version 3 of the BedMachine Greenland data set for ice thickness and surface elevation \citep{morlighem2017bedmachine} and the MEaSUREs annual velocity mosaic from 2015-2016 \citep{joughin2010greenland} to infer the basal friction.
To force the mass conservation equation \eqref{eq:conservation-mass}, we need to provide a surface mass balance (SMB) field $\dot a$ and a melt rate $\dot m$.
We used a surface mass balance field that varies linearly with elevation:
\begin{equation}
    \dot a \approx a_0 + \frac{\delta a}{\delta s}\cdot s
\end{equation}
where $a_0$ is the SMB at sea level and $\delta a/\delta s$ is the SMB lapse rate.
To fit the parameters $a_0$ and $\delta a/\delta s$, we used output from 2006-2021 of version 3.12 of the Mod\`ele Atmosph\'erique R\'egional (MAR) \citep{fettweis2020grsmbmip}.
This regional climate model has been tested extensively for the polar regions and for Greenland.
The fit had $r^2 = 0.91$, so a substantial fraction of the variance is explainable by surface elevation alone.

To set the melt rate $\dot m$, we first created a smoothed ice mask $\mu$.
The smoothed mask is required to be equal to 1 on the inflow boundary, 0 on the outflow boundary, and have 0 normal derivative along the side walls.
We then compute $\mu$ as the minimizer of
\begin{equation}
    J(\mu) = \frac{1}{2}\int_\Omega\left((\mu - \mathbf{1}_{\{h > 0\}})^2 + \alpha^2|\nabla\mu|^2\right)dx
\end{equation}
where $\alpha$ is some smoothing length, and $\mathbf{1}_{\{h > 0\}}(x)$ is equal to 1 if $h(x) > 0$ and 0 if $h(x) = 0$.
Here we choose $\alpha$ to be 1km, so the mask field rapidly approaches 1 within roughly one ice thickness of the terminus.
The mask field $\mu$ is recalculated in every timestep.
Finally, we set the melt rate at time $t$ as
\begin{equation}
    \dot m = m_0(1 - \mu)\min\{0, \cos(2\pi t)\}
\end{equation}
where $m_0$ is manually tuned to produce roughly realistic terminus variations.
We used a value of $m_0$ on the order of 20 km/yr \textcolor{red}{tune it some more}.
Spread over an inland distance of roughly 1 km in a 5 km-wide fjord for only the summer season, this gives a total discharge roughly of the same order as the observed value of 24 km${}^3$/yr \citep{king2018seasonal}.

\textcolor{red}{Description of results}

Several processes govern the terminus dynamics of Greenland outlet glaciers, including frontal ablation from ocean melt, stress-induced crevassing and calving, and back-pressure from sea ice or ice melange in the fjord.
We did not attempt to include a real calving law in this exercise.
Moreover, we used an ad hoc approach to simulate frontal ablation by instead applying high surface melt that ramps up within a small distance of the terminus.
We are nonetheless able to simulate ice-free areas and the advance and retreat of the glacier terminus using the dual form of the momentum balance equations.
Closing the gap between the simple demonstrative parameterizations used here and reality is the subject of future work.
For example, one could add calving by setting the ice thickness to zero in areas near the glacier terminus where surface crevasses would penetrate to the water line according to the Nye criterion.


\section{Discussion}

\textcolor{red}{Finish this...}

Using the dual formulation of the problem has several advantages.
The stress tensor may be an input to other parts of the physics.
For example, it is part of the source terms for both heat and damage.
The dual formulation includes the stress explicitly as an unknown in the problem.
Solving for it directly offers greater accuracy than computing it after the fact from the velocity field.
Second, the dual formulation reverses the behavior of all the nonlinearities around the zero-disturbance state.
Infinite singularities in the primal formulation, which can only be dealt with by fudging the problem itself, become zero degeneracies in the dual.
These degeneracies are still a challenge.
But the problem, with no modifications, is amenable to solution by continuation methods.
We believe that trust region methods might work as well and this remains to be explored.

The dual formulation does come with several disadvantages.
The number of unknowns in the dual formulation is much greater than in the primal form, thus putting more pressure on computer memory.
The resulting linear systems are indefinite rather than positive-definite.
Finally, the choice of finite element basis is much more delicate.
The dual formulation offers alternative possibilities for incorporating plastic yield as an inequality constraint.
\textcolor{red}{Elaborate...}



% -------
\appendix

% -----------------------------------------
\section{Discretization by finite elements}
\label{app:discretization}

Roughly any conforming finite element basis is stable for the primal form of the groundwater flow equation as long as the mesh is regular.
The most common choice is to use piecewise-continuous polynomials of a given degree $k$ on triangles, or the tensor product of polynomials on quads.
We will refer to this basis as $CG(k)$.
While dual formulations have many advantages, the main challenge to overcome is that most choices of basis are unstable -- the resulting linear systems are either singular or their inverses have unbounded norm in the limit as the mesh is refined.
For example, using $CG(k)$ elements for the pressure and the product $CG(k)^2$ for the velocity is an unstable discretization of the dual form of the groundwater problem.
Making matters even harder, the SSA and other problems for a pair of vector and tensor fields have an additional invariant to enforce -- the symmetry of the stress tensor -- which can be difficult to achieve in practice.

The question of how to choose basis functions that give a stable discretization of dual problems is the subject of \emph{mixed} finite element methods.
This subject is covered in great detail in \citet{boffi2013mixed}.
There is, however, a wide chasm between the motivation for using dual formulations in most of the finite element literature and our reasons for applying them to glacier momentum balance.
The big motivating problem for dual formulations in the finite element literature is linear elasticity.
In that setting, the goal is to compute the stress tensor with high accuracy in order to make sure that it does not exceed some failure threshold for the material.
Using the dual form of the elasticity equations offers the promise of approximating the stress tensor with a higher order of accuracy than the primal form.
Finding stable finite element bases for the dual form of the elasticity equations is a holy grail problem because of its potential impact on engineering practice.

It might seem at first blush as if the heavy focus on finding stable discretizations of the dual form of the elasticity equations is beneficial to us because the SSA is formally similar to 2D elasticity, even though these equations have different provenance.
Our purpose for using the dual form, however, is not to obtain a more accurate resolution of the membrane stress tensor -- we are only interested in the dual form because of how it changes the character of the nonlinearities in the SSA.
With this goal in mind, there are several choices that we make differently from how they are done in the finite element literature.
These are of a technical nature and not of special interest to most glaciologists, but we include them here for the sake of completeness.
A typical dual formulation of elasticity would assume that:
\begin{enumerate}
    \item the displacements live in the function space $L^2(\Omega, \mathbb{R}^d)$, i.e. the space of square-integrable vector fields, and
    \item the stresses live in the space $H^{\text{div}}(\Omega, \mathbb{R}_{\text{sym}}^{d \times d})$ of square-integrable symmetric tensor fields whose divergences are also square-integrable.
\end{enumerate}
This $L^2 \times H^{\text{div}}$ formulation offers the best possible asymptotic accuracy for the stress tensor.
The dual form of the problem with these assumptions is different from what we wrote down in equation \eqref{eq:ssa-dual-form} -- the gradient of $u$ is instead pushed over as a stress divergence.
Moreover, with the $L^2 \times H^{\text{div}}$ form, Dirichlet boundary conditions become natural and Neumann conditions become essential.
Finding stable bases for the $L^2\times H^{\text{div}}$ form requires very sophisticated finite element bases.
At the simplest end of the spectrum, one can enrich the stress space by cubic bubbles \citep{brezzi1993mixed}.
A host of more complex approaches are possible \citep{arnold1984peers, arnold2002mixed}.

Although it is almost completely unheard of in the literature on mixed finite elements, we make a different but equally valid set of assumptions.
We instead assume that
\begin{enumerate}
    \item the velocities live in the function space $H^1(\Omega, \mathbb{R}^d)$ of vector fields that are square-integrable and have square-integrable derivatives, and
    \item the membrane stress tensor lives in the space $L^2(\Omega, \mathbb{R}^{d \times d}_{\text{sym}})$ of square-integrable symmetric tensor fields.
\end{enumerate}
With this $H^1 \times L^2$ dual form, Dirichlet conditions remain essential and Neumann conditions natural.
Finding a stable finite element basis is much more straightforward for the $H^1\times L^2$ form of the problem.
We use the space $CG(k)^d$ of continuous piecewise-polynomial vector fields for the velocities, and $DG(k)^{d\times d}_{\text{sym}}$ of discontinuous piecewise-polynomial symmetric tensor fields for the membrane stress.



% ---------------------------------------
\section{Solution by Newton-type methods}
\label{app:solution}

The finite element method reduces the infinite-dimensional optimization problems that we have described into finite-dimensional ones.
All that remains is to decide how to solve the resulting finite-dimensional optimization problems.

We can approximate a minimizer for the primal form of the action functional using standard Newton line search algorithms \citep{shapero2021icepack}.
But the primal form of the momentum balance equation has singularities in the limit as the strain rate tensor approaches 0.
When we calculate the derivative of the action, these singularities are multiplied by 0 in such a way that they become removable, i.e. they have a finite limit.
In floating-point arithmetic, however, evaluating an expression with a removable singularity does not always produce the right limit.
Moreover, the second derivative of the action does have genuine infinite singularities, and we need to be able to calculate the second derivative or some approximation to it in order to use Newton-type methods.
The usual remedy is to introduce a smoothing factor $\delta$ into the action that rounds off the behavior around $\dot\varepsilon = 0$.
Regularizing the action functional makes the minimization problem solvable but very ill-conditioned.
Additionally, for some simulations the ice thickness can go to zero, which makes the minimization problem difficult or impossible to solve numerically.
The usual remedy for this is to clamp the thickness from below at some fixed value, say 1m or 10m.
Where the ice thickness approaches zero, usually the strain rate does as well.
In these scenarios, we are certain to encounter the worst behavior possible associated with the singularity at zero strain rate.

The dual form, on the other hand, does not have infinite singularities around zero strain rate.
Instead, the action functional has \emph{degeneracies} -- terms that go to zero where, in a nicer problem, they would stay strictly positive.
(See again figure \ref{fig:primal-vs-dual}.)
Degeneracies are not good news either.
In order to use a Newton-type algorithm to find a critical point of the dual action $L$, we compute a search direction by solving the linear system
\begin{equation}
    d^2L\cdot\left(\begin{matrix} v \\ N \\ \sigma\end{matrix}\right) = -dL.
\end{equation}
We know that the second derivative of $L$ has the structure of a saddle-point matrix.
Usually one assumes that certain blocks of this matrix are symmetric and strictly positive-definite in order to guarantee the existence of a solution \citep{boffi2013mixed}.
When the problem is degenerate, we no longer have these guarantees.
We still know that $L$ has a unique saddle point because it is \emph{strictly} convex with respect to $M$ and $\tau$, the problem is that it fails to be \emph{strongly} or \emph{uniformly} convex.
There are workable remedies for this issue that do not degrade the conditioning of the problem to the same extent as regularization does for the primal problem.

\subsection{Perturbed Hessian}

Newton's method with line search guarantees second-order convergence for nice problems.
In the event that the second derivative has degeneracies, we can instead try to compute a search direction b solving the perturbed system
\begin{equation}
    \left(d^2L + \lambda\cdot d^2G\right)\left(\begin{matrix} v \\ N \\ \sigma\end{matrix}\right) = -dL
    \label{eq:regularized-newton-step}
\end{equation}
where $G$ is some strongly convex function of $M$ and $\tau$ and $\lambda$ is a small parameter.
For example, one reasonable choice is to take
\begin{equation}
    G = \frac{1}{2}\int_\Omega\left(\max\{h, h_{\text{min}}\}A'|M|_{\mathscr{A}}^2 + K'|\tau|^2\right)dx
\end{equation}
for some constants $A'$, $K'$ having the right units and for some minimum thickness $h_{\text{min}}$ on the order of 1-10m.
The addition of $d^2G$ regularizes the search directions.
It does \emph{not} regularize or perturb what solution we are looking for, only how we look for it.

Regularizing the search directions likely sacrifices the second-order convergence rate of Newton's method.
It does, however, achieve faster convergence than typical first-order quasi-Newton methods like BFGS \citep{nocedal2006numerical}.

\subsection{Trust region methods}

We can also abandon the line search idea entirely and use trust region methods.
For a detailed discussion of trust region methods, see \citet{nocedal2006numerical} or \citet{conn2000trust}.
Trust region methods instead adaptively select $\lambda$ in equation \eqref{eq:regularized-newton-step} to be as small as possible while approaching the critical point of the dual action as rapdily as possible.
One of the key advantages of trust region methods is that they can cope well with functional that have degenerated second derivatives while still achieving superlinear or even quadratic convergence rates.

\subsection{Linearly implicit schemes}
\label{subsec:linearly-implicit-schemes}

Finally, we might recognize that the momentum balance equation is only one part of the overall dynamics.
For a time-dependent simulation these are certain to include the mass balance equation, and they may include heat flow or other effects as well.
The overall structure including mass balance is a differential-algebraic equation:
\begin{align}
    \partial_th & = F(h; u, \ldots) \\
    0 & = dL(u, M, \tau; h, \ldots)
\end{align}
A typical timestepping scheme to solve these equations proceeds by (1) updating the thickness using the mass balance equation, and then (2) solving the momentum balance equation with the new value of the thickness:
\begin{align}
    \frac{h_{k + 1} - h_k}{\delta t} & = F(h_{k + 1}; u_k, \ldots) \\
    0 & = dL(u_{k + 1}, M_{k + 1}, \tau_{k + 1}; h_{k + 1}, \ldots)
\end{align}
Although it requires more work, we could solve the mass and momentum balance equations simultaneously:
\begin{align}
    \frac{h_{k + 1} - h_k}{\delta t} & = F(h_{k + 1}; u_{k + 1}, \ldots) \\
    0 & = dL(u_{k + 1}, M_{k + 1}, \tau_{k + 1}; h_{k + 1}, \ldots)
\end{align}
The time discretization here is the simplest first-order backward differencing scheme.
This scheme is L-stable, which is desirable for problems like glacier flow that are predominantly dissipative \citep{wanner1996solving}.
One could also use more sophisticated implicit Runge-Kutta methods.

The idea of \emph{linearly implicit} or \emph{Rosenbrock} schemes is that, rather than solve a nonlinear equation to convergence in every timestep, we can instead do a single iteration of Newton's method \citep{wanner1996solving}.
The thinking behind this approach is that, if the timestep is not too large, the first Newton iteration usually does the bulk of the error reduction.
This is not as accurate as solving the nonlinear system as precisely as possible.
But if the original nonlinear scheme converges asymptotically as $\delta t^p$ then the linearly implicit scheme does too.
In other words, the ``lazy'' approach may do worse, but only by a constant factor -- the convergence rate is the same.
Equally as important, linearly implicit schemes retain all of the favorable stability properties of fully implicit methods.

We still have not answered how linearly implicit schemes are a solution to the degeneracy issue.
The key trick is that \textbf{one does not need to use the exact linearization in a linearly implicit scheme} in order to achieve the same convergence rate.
For example, we can use the perturbation from equation \eqref{eq:regularized-newton-step}.



\pagebreak

\bibliographystyle{plainnat}
\bibliography{dual-problems.bib}

\end{document}

